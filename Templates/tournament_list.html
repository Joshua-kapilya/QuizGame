{% extends "layout.html" %}

{% block content %}
<div class="tournaments-container">
    <h1>Ongoing & Upcoming Tournaments</h1>

    {% if tournaments %}
        <div class="tournament-list">
            {% for tournament in tournaments %}
                <div class="tournament-card">
                    <div class="tournament-info">
                        <a href="{% url 'tournament_detail' tournament.id %}">
                            {{ tournament.name }}
                        </a>
                        <span class="dates">
                            ({{ tournament.start_date }} - {{ tournament.end_date }})
                        </span>
                    </div>

                    <!-- âœ… Add both start & end dates -->
                    <div class="tournament-timer"
                         data-start-date="{{ tournament.start_date|date:'Y-m-d H:i:s' }}"
                         data-end-date="{{ tournament.end_date|date:'Y-m-d H:i:s' }}">
                        Loading...
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No active or upcoming tournaments right now.</p>
    {% endif %}
</div>

<style>
.tournaments-container {
    max-width: 900px;
    margin: 2rem auto;
    padding: 1.5rem;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    color: #fff;
    font-family: Arial, sans-serif;
}
.tournaments-container h1 {
    text-align: center;
    margin-bottom: 1.5rem;
    font-size: 2rem;
}
.tournament-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
.tournament-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem 1.5rem;
    border-radius: 10px;
    transition: transform 0.2s ease, background 0.2s ease;
}
.tournament-card:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-3px);
}
.tournament-info a {
    font-size: 1.2rem;
    font-weight: bold;
    color: #ffeb3b;
    text-decoration: none;
}
.tournament-info a:hover {
    text-decoration: underline;
}
.dates {
    font-size: 0.9rem;
    margin-left: 0.5rem;
    color: #ddd;
}
.tournament-timer {
    font-size: 1rem;
    font-weight: bold;
    color: #ffeb3b;
    background: rgba(0,0,0,0.3);
    padding: 0.3rem 0.8rem;
    border-radius: 8px;
}
</style>

<script>
function updateTimers() {
    document.querySelectorAll(".tournament-timer").forEach(timer => {
        const startDate = new Date(timer.getAttribute("data-start-date")).getTime();
        const endDate = new Date(timer.getAttribute("data-end-date")).getTime();
        const now = new Date().getTime();

        let label, distance;

        if (now < startDate) {
            // Tournament not started yet
            label = "Starts in";
            distance = startDate - now;
        } else if (now >= startDate && now < endDate) {
            // Tournament ongoing
            label = "Ends in";
            distance = endDate - now;
        } else {
            // Tournament ended
            timer.textContent = "Ended";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        timer.textContent = `${label}: ${days}d ${hours}h ${minutes}m ${seconds}s`;
    });
}

setInterval(updateTimers, 1000);
updateTimers();
</script>
{% endblock %}
